## Настройка домена 
DNS расшифровывается как Domain Name System. 
Это глобальное распределенное хранилище ключей и значений.
Сервера по всему миру могут предоставить вам значение по ключу, 
а если им неизвестен ключ, 
то они попросят помощи у другого сервера.

ДНС сервер домена отвечает за то, откуда будут 
браться текстовые записи домена. 

У домена есть несколько типов записей.
Самый важный из них это **A - запись**. А - запись 
отвечает за ip адрес, куда будет направляться запрос
по этому домену.
**A** - это address (адрес), и это один из фундаментальных
видов записей в DNS.
**A** содержит один IPv4-адрес.

[Подробнее о DNS](https://habr.com/ru/post/303446/)

Давайте взглянем на маппинг между именем и адресом:

```bash
dig test.com
```
**dig** - (сокращение от «domain information groper») — утилита
(DNS-клиент), предоставляющая пользователю интерфейс 
командной строки для обращения к системе DNS. 
Позволяет задавать различные типы запросов и 
запрашивать произвольно указываемые сервера. 
Является аналогом утилиты nslookup.

В результате запроса выше мы получаем ответ

```text
; <<>> DiG 9.16.1-Ubuntu <<>> test.com
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 39067
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 65494
;; QUESTION SECTION:
;test.com.			IN	A

;; ANSWER SECTION:
test.com.		3585	IN	A	69.172.200.235

;; Query time: 0 msec
;; SERVER: 127.0.0.53#53(127.0.0.53)
;; WHEN: Вс апр 18 15:29:55 MSK 2021
;; MSG SIZE  rcvd: 53

```
Здесь есть только одна интересная деталь: информация о самом запросе. 
Говорится, что мы запросили запись и получили 
ровно один ответ. Вот:
```text
;; QUESTION SECTION:
;test.com.			IN	A

;; ANSWER SECTION:
test.com.		3585	IN	A	69.172.200.235
```
dig по-умолчанию запрашивает A-записи.

Тут говорится, что у хоста test.com. 
есть один адрес A: 69.172.200.235.


```text
Как правило, текстовые записи домена настраиваются 
у регистратора домена, но в случае, еслт DNS сервера домена
были изменены, A - записи следует искать по адресу
DNS сервера. 
```

[Подробнее](https://help.r01.ru/dns/faq/types_records.html)

### Взаимодействие сети 

Вводя в адресную строку адрес домнена, информация об
этом домене сначала ищется в локальном файле hosts, 
затем информация запрашивается у твоего провайдера,
в случае если провайдер знает о домене, он отдает
url dns сервера домена. 

Далее запрос уходит на этот url(dns сервер), который
отдает текстовый файл со всеми текстовыми записями домена.

Далее браузер сопоставлет вводимый url с необходимой 
A - записью и смотрит на ее IP. После чего отсылает
запрос по этому IP.

```text
На 1 IP может ссылаться неограниченное количество 
доменов, а так же поддомен может ссылаться на 
совершенно другой IP.
```

## Сервер 

Сервера бывают двух типов: 
KVM и OpenVZ - это типы виртуализации. 

**KVM** - это виртуализация, в которой каждая нода
(условно, кусок большого сервера), принадлежит тебе 
и только тебе, твои ресурсы не могут быть распределены
другим(виртуализация на уровне железа).

**OpenVZ** - виртуализация на уровне софта, твои
ресурсы могут быть заняты в случае высокой нагрузки
большого сервера.

Рекомендуется использовать всегда KVM виртуализацию,
помимо очевидных преимуществ, kVM отличается 
наличием масштабируемости(при росте нагрузки на проект
можно увеличить ресурсы сервера).
 
### Практика

Чтобы подключиться к удаленному серверу, обычно
используется протокол **SSH**, также распространен
способ подключения через **VNC**, но как правило
программистам он не нужен.

Чтобы подключиться к удаленному серверу мы используем
команду 
```bash
ssh root@149.154.67.71
```
Где, `root` - это имя пользователя на удаленной машине,
`149.154.67.71` - ip адрес или доменное имя сервера 

### Необходимый софт
Для обновления базы данных пакета
```bash
apt update
```
Далее обновляем установленные пакеты с помощью apt
```bash
apt upgrade
```
Перезагружаем Linux-серверы
```bash
reboot
```
Первым делом на сервер необходимо установить

- nano - текстовый редактор
- mc - файловый менеджер
- htop - системный монитор
- language-pack-ru - русификация консоли и поддержка
кириллицы
  
  
### Первые шаги

Первым делом в настройке нового сервера необходимо
создать пользователя отличного от root. Под которым
в дальнейшем мы и будем работать.
```text
Как правило, при "взрослой" настройке сервера 
авторизацию по ssh от пользователя root вообще запрещают
```
Для создания пользователя используем команду 
```bash
useradd username 
```

Далее необходимо выдать пользователю доступ к sudo.
```bash
usermod -aG sudo username
```

Далее необходимо создать папку пользователя в директории
/home/

`mkdir /home/username`

и поменять владельца у этой папки 

`chown username:usergroup userdir`

где username - имя пользователя, usergroup - группа
пользователя(по умолчанию имя пользователя), userdir -
домашняя директория пользователя.

также, необходимо дать пароль для доступа на сервер
созданному пользователю
`passwd username`

Папка с сайтами будет лежать в домашней директории
`~/www`
